[build]
  # IMPORTANT: In Netlify dashboard, ensure "Base directory" is empty (repo root)
  # Site settings → Build & deploy → Continuous Deployment → Base directory: (empty)
  command = "npx convex deploy --cmd-url-env-var-name VITE_CONVEX_URL --cmd 'pnpm --filter web build'"
  publish = "apps/web/dist/client"
  # The @netlify/vite-plugin-tanstack-start plugin automatically configures functions
  # It will create the function in .netlify/functions/server (relative to repo root)
  functions = ".netlify/functions"
  
[build.environment]
  NODE_VERSION = "20"
  PNPM_VERSION = "10.13.1"
  
# Production environment variables should be set in Netlify dashboard:
# - VITE_CONVEX_URL (set automatically by convex deploy during build)
# - Any other environment variables your app needs

# The @netlify/vite-plugin-tanstack-start plugin automatically handles redirects
# But we'll keep this explicit redirect to ensure it works correctly
[[redirects]]
  from = "/*"
  to = "/.netlify/functions/server"
  status = 200
